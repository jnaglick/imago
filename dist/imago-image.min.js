var imagoImage,imagoImageController;imagoImage=function(){function e(e,i,a,o,t,n,r){return{replace:!0,scope:!0,templateUrl:"/imago/imago-image.html",controller:"imagoImageController as imagoimage",require:"?^imagoSlider",bindToController:!0,link:function(o,t,s,g){var l,m,u,c,d,v,h,f,z,p,w;f={},o.visible=!1,o.source=void 0,v={align:"center center",sizemode:"fit",hires:!0,responsive:!0,scale:1,lazy:!0,maxsize:4e3};for(d in s)p=s[d],v[d]="true"===p||"false"===p?JSON.parse(p):p;return o.imagoimage.opts=v,c=/[0-9a-fA-F]{24}/,f.watch=s.imagoImage.match(c)?s.$observe("imagoImage",function(e){return e?(o.source=r.find({_id:e}),s.watch||f.watch(),m()):void 0}):o.$watch(s.imagoImage,function(e){return function(e){return e?(o.source=e,s.watch||f.watch(),m()):void 0}}(this)),m=function(){var e;return v.servingSize=null,(null!=(e=o.source)?e.serving_url:void 0)?(o.source.fields.hasOwnProperty("crop")&&!s.align&&(v.align=o.source.fields.crop.value),o.source.fields.hasOwnProperty("sizemode")&&("default"===o.source.fields.sizemode.value||s.sizemode||(v.sizemode=o.source.fields.sizemode.value)),v.responsive&&"crop"===v.sizemode&&o.$on("resizelimit",function(){return l(),o.$evalAsync()}),u()):void t.remove()},u=function(){var i,a,r,s,l,m;return angular.isString(o.source.resolution)&&(r=o.source.resolution.split("x"),v.resolution={width:r[0],height:r[1]},v.assetRatio=r[0]/r[1]),"preloading"===o.imagoimage.status?console.log("tried to render during rendering!!"):(o.imagoimage.status="preloading",o.align=v.align,o.sizemode=v.sizemode,l=t[0].clientWidth,a=t[0].clientHeight,a&&(m=l/a),i=v.hires?Math.ceil(e.devicePixelRatio)||1:1,"crop"===v.sizemode&&a?s=Math.round(v.assetRatio<=m?Math.max(l,l/v.assetRatio):Math.max(a,a*v.assetRatio)):a&&"height"!==v.autosize?l&&"width"!==v.autosize?s=Math.round(v.assetRatio<=m?Math.max(a,a*v.assetRatio):Math.max(l,l/v.assetRatio)):(v.autosize="width",s=Math.round(Math.max(a,a*v.assetRatio))):(v.autosize="height",v.maxHeight=Math.round(l/v.assetRatio),s=Math.round(Math.max(l,l/v.assetRatio))),s=parseInt(Math.min(s*i,v.maxsize),10),s===v.servingSize?void(o.imagoimage.status="loaded"):(v.servingSize=s,v.servingUrl=n.isBaseString(o.source.serving_url)?o.source.serving_url:o.source.serving_url+"=s"+s*v.scale,g&&g.setServingSize("=s"+s*v.scale),h()))},h=function(){var e;return v.lazy&&!o.visible?f.visibleFunc=o.$watch("visible",function(e){return function(e){return e?(f.visibleFunc(),o.visible=!0,h()):void 0}}(this)):(e=angular.element("<img>"),e.on("load",function(e){return"crop"===v.sizemode?o.imagoimage.imageStyle={backgroundImage:"url("+v.servingUrl+")",backgroundSize:l(),backgroundPosition:v.align}:(o.servingUrl=v.servingUrl,v.maxHeight&&(o.imagoimage.imageStyle={"max-height":v.maxHeight+"px"})),o.imagoimage.status="loaded",o.$evalAsync()}),e[0].src=v.servingUrl)},l=function(){var e,i,a;return i=t[0].clientWidth,e=t[0].clientHeight,e&&(a=i/e),"crop"===v.sizemode?o.imagoimage.imageStyle["background-size"]=v.assetRatio<a?"100% auto":"auto 100%":void 0},z=function(){var e;return"crop"===v.sizemode?e={backgroundImage:"url("+v.servingUrl+")",backgroundSize:l(),backgroundPosition:v.align}:void(o.servingUrl=v.servingUrl)},w={},v.responsive&&(w.resizestop=i.$on("resizestop",function(){return o.imagoimage.status="loading",o.source?u():void 0})),o.$on("$stateChangeSuccess",function(){return a(function(){return n.fireEvent("checkInView")})}),angular.element(e).on("orientationchange",u),o.$on("$destroy",function(){var e;e=[];for(d in w)e.push(w[d]());return e})}}}return e}(),imagoImageController=function(){function e(e){this.status="loading",this.imageStyle={},angular.isDefined(e.lazy)&&"false"===e.lazy&&(this.removeInView=!0)}return e}(),angular.module("imago").directive("imagoImage",["$window","$rootScope","$timeout","$parse","$log","imagoUtils","imagoModel",imagoImage]).controller("imagoImageController",["$attrs",imagoImageController]),angular.module("imago").run(["$templateCache",function(e){e.put("/imago/imago-image.html",'<div visible="visible" in-view="visible = $inview" in-view-options="{debounce: 100}" in-view-remove="imagoimage.removeInView" ng-style="elementStyle" ng-class="[imagoimage.status, align]" ng-switch="sizemode" class="imagoimage"><img ng-src="{{servingUrl}}" ng-style="imagoimage.imageStyle" ng-switch-when="fit" class="imagox23"/><div ng-style="imagoimage.imageStyle" ng-switch-when="crop" class="imagox23"></div><div ng-hide="imagoimage.status === \'loaded\'" class="loading"><div class="spin"></div><div class="spin2"></div></div></div>')}]);